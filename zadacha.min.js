let theme=document.getElementById("mainThemeCss");"lightTheme.css"!==localStorage.getItem("theme")&&"darkTheme.css"!==localStorage.getItem("theme")||(theme.attributes[2].textContent=localStorage.getItem("theme"),"lightTheme.css"===localStorage.getItem("theme")&&document.querySelector(".tumbler").classList.toggle("tumbler--night-mode"));let tableProduct=document.getElementById("tableProduct"),tr,newTotalSum,initialQuantity,initialPrice,number=0;const errorProduct=document.getElementById("error-product"),errorQuantity=document.getElementById("error-quantity"),errorPrice=document.getElementById("error-price"),overlay=document.getElementById("overlay"),addСlick=document.getElementById("addСlick"),addModalWindow=document.getElementById("modalParameters"),replaceWithSave=document.getElementById("dobav"),product=document.getElementById("product"),quantity=document.getElementById("quantity"),price=document.getElementById("price");addСlick.addEventListener("click",()=>{addModalWindow.classList.add("md-show"),overlay.classList.remove("d-none"),errorProduct.classList.add("d-none"),errorQuantity.classList.add("d-none"),errorPrice.classList.add("d-none"),"Сохранить"===replaceWithSave.value&&(replaceWithSave.value="Добавить")});const tumblerWrapper=document.querySelector(".tumbler__wrapper");tumblerWrapper.addEventListener("click",()=>{document.querySelector(".tumbler").classList.toggle("tumbler--night-mode");let theme=document.getElementById("mainThemeCss");"lightTheme.css"===theme.attributes[2].textContent?(theme.attributes[2].textContent="darkTheme.css",localStorage.setItem("theme","darkTheme.css")):(theme.attributes[2].textContent="lightTheme.css",localStorage.setItem("theme","lightTheme.css"))}),addModalWindow.addEventListener("click",e=>{let elementHtml=e.target;if(elementHtml.classList.contains("click-add")){let spanTotalSum=document.getElementById("totalSum"),fields,countErrors=0;if([{name:"product",field:product,error:errorProduct},{name:"quantity",field:quantity,error:errorQuantity},{name:"price",field:price,error:errorPrice}].forEach((function(el){"product"!==el.name&&+el.field.value<1||""===el.field.value?(el.error.classList.remove("d-none"),countErrors++):el.error.classList.add("d-none")})),countErrors>0)return;if("Добавить"===replaceWithSave.value){number+=1;let td1=document.createElement("td");td1.textContent=number,td1.classList.add("title-style");let td2=document.createElement("td");td2.textContent=product.value,td2.classList.add("title-style-font");let td3=document.createElement("td");td3.textContent=quantity.value+" шт",td3.classList.add("title-style-font");let td4=document.createElement("td");td4.textContent=price.value+" p",td4.classList.add("title-style-font");let div1=document.createElement("div");div1.innerHTML="&#10004;",div1.classList.add("td-hov1");let div2=document.createElement("div");div2.innerHTML="&#10008;",div2.classList.add("td-hov2");let edit=document.createElement("div");edit.innerHTML="&#9998;",edit.classList.add("edit");let td5=document.createElement("td");td5.append(div1),td5.append(div2),td5.append(edit);let tr=document.createElement("tr"),tbody;tr.classList.add("stroka"),tr.append(td1),tr.append(td2),tr.append(td3),tr.append(td4),tr.append(td5),document.querySelector("tbody").append(tr);let totalSum=+spanTotalSum.textContent,productQuantity,productPrice,productSum;totalSum+=+quantity.value*+price.value,spanTotalSum.textContent=totalSum}else{console.dir(tr),tr.children[1].textContent=product.value,tr.children[2].textContent=quantity.value+" шт",tr.children[3].textContent=price.value+" p";let totalSum=+spanTotalSum.textContent,initialResult,initialAmountLine,updatedTotal,newPrice,newQuantity,newAmountLine;totalSum=totalSum-initialQuantity*initialPrice+price.value*quantity.value,spanTotalSum.textContent=totalSum}tableProduct.classList.contains("d-none")&&tableProduct.classList.remove("d-none"),product.value="",quantity.value="",price.value="",addModalWindow.classList.remove("md-show"),overlay.classList.add("d-none")}elementHtml.classList.contains("click-cancellation")&&(addModalWindow.classList.remove("md-show"),overlay.classList.add("d-none"))});const myModal=document.getElementById("myModal"),tableBody=document.getElementById("tableBody");tableBody.addEventListener("click",(function(e){let span=e.target;if(tr=span.parentNode.parentNode,"td-hov1"===span.className&&(tr.classList.add("str-stile"),tr.classList.add("strikeout"),span.classList.add("hidden")),"td-hov2"===span.className&&(myModal.classList.add("md-show"),overlay.classList.remove("d-none")),"edit"===span.className){let productСontent=tr.children[1].textContent,quantityСontent=parseInt(tr.children[2].textContent),priceСontent=parseInt(tr.children[3].textContent);addModalWindow.classList.add("md-show"),overlay.classList.remove("d-none");const replaceWithSave=document.getElementById("dobav");let product;replaceWithSave.value="Сохранить",document.getElementById("product").value=productСontent;let quantity=document.getElementById("quantity");quantity.value=quantityСontent;let price=document.getElementById("price");price.value=priceСontent,initialQuantity=quantity.value,initialPrice=price.value}})),myModal.addEventListener("click",e=>{let сrossDiv=e.target;if("hystmodal__close2"===сrossDiv.className&&(myModal.classList.remove("md-show"),overlay.classList.add("d-none")),"hystmodal__close1"===сrossDiv.className){myModal.classList.remove("md-show"),overlay.classList.add("d-none"),tr.remove();const numberDeleteLine=+tr.firstElementChild.textContent;let tableLines=document.querySelectorAll("tbody tr");for(let i=0;i<tableLines.length;i++){let currentTr=tableLines[i],numberLine=+currentTr.firstElementChild.textContent;numberDeleteLine<numberLine&&(currentTr.firstElementChild.textContent=numberLine-1)}0===tableLines.length&&tableProduct.classList.add("d-none");let productСontent=tr.children[1].textContent,quantityСontent,priceСontent,totalAmount=parseInt(tr.children[2].textContent)*parseInt(tr.children[3].textContent),spanTotalSum=document.getElementById("totalSum"),totalSum=spanTotalSum.textContent-totalAmount;spanTotalSum.textContent=totalSum}});